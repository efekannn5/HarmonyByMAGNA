{% extends "base.html" %}
{% block title %}Timeline Analysis{% endblock %}
{% block page_title %}Production Timeline Analysis{% endblock %}

{% block content %}
<div class="row g-4 mb-4">
    <div class="col-md-12">
        <div class="chart-card">
            <h6><i class="bi bi-graph-up"></i> Average Duration by Stage (Minutes)</h6>
            <canvas id="timelineChart" height="100"></canvas>
        </div>
    </div>
</div>

<div class="row g-4 mb-4">
    <div class="col-md-6">
        <div class="chart-card">
            <h6><i class="bi bi-clock"></i> Production to Scan</h6>
            <div class="text-center py-3">
                <div style="font-size: 36px; font-weight: 700; color: #3b82f6;" id="prodToScan">-</div>
                <div class="text-muted">Average Minutes</div>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="chart-card">
            <h6><i class="bi bi-truck"></i> Scan to Loading</h6>
            <div class="text-center py-3">
                <div style="font-size: 36px; font-weight: 700; color: #fbbf24;" id="scanToLoad">-</div>
                <div class="text-muted">Average Minutes</div>
            </div>
        </div>
    </div>
</div>

<div class="row g-4">
    <div class="col-md-6">
        <div class="chart-card">
            <h6><i class="bi bi-laptop"></i> Loading to Web Entry</h6>
            <div class="text-center py-3">
                <div style="font-size: 36px; font-weight: 700; color: #f87171;" id="loadToWeb">-</div>
                <div class="text-muted">Average Minutes</div>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="chart-card">
            <h6><i class="bi bi-send"></i> Web Entry to Shipment</h6>
            <div class="text-center py-3">
                <div style="font-size: 36px; font-weight: 700; color: #10b981;" id="webToShip">-</div>
                <div class="text-muted">Average Minutes</div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
fetch('/analytics/api/timeline')
    .then(r => r.json())
    .then(data => {
        document.getElementById('prodToScan').textContent = 
            data.prod_to_scan ? Math.round(data.prod_to_scan) : '-';
        document.getElementById('scanToLoad').textContent = 
            data.scan_to_load ? Math.round(data.scan_to_load) : '-';
        document.getElementById('loadToWeb').textContent = 
            data.load_to_web ? Math.round(data.load_to_web) : '-';
        document.getElementById('webToShip').textContent = 
            data.web_to_ship ? Math.round(data.web_to_ship) : '-';
        
        const ctx = document.getElementById('timelineChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Production→Scan', 'Scan→Loading', 'Loading→Web', 'Web→Shipment'],
                datasets: [{
                    label: 'Average Duration (min)',
                    data: [data.prod_to_scan, data.scan_to_load, data.load_to_web, data.web_to_ship],
                    backgroundColor: ['#3b82f6', '#fbbf24', '#f87171', '#10b981']
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: false } },
                scales: { y: { beginAtZero: true } }
            }
        });
    });
</script>
{% endblock %}
