<!doctype html>
<html lang="tr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ title or "Harmony Web Console" }} | Harmony Web Console</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/orjlogo.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}?v=2.5">
  </head>
  {% set endpoint = request.endpoint or '' %}
  {% set is_auth_page = endpoint in ['auth.login'] %}
  {% set display_name = current_user.DisplayName or current_user.Username if current_user.is_authenticated else '' %}
  {% set role_name = current_user.role.Name.lower() if current_user.is_authenticated and current_user.role and current_user.role.Name else '' %}
  <body class="{{ 'auth-body' if is_auth_page else '' }}">

    {% if not is_auth_page %}
    <div class="ambient-bg"></div>
    {% endif %}
    <div class="app-shell">
      {% if not is_auth_page %}
      <header class="site-header">
        <div class="header-core">
          <div class="brand-mark">
            <div class="brand-logo">
              <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Magna Logo">
            </div>
            <div class="brand-text">
              <span class="brand-label">Magna</span>
              <strong>Harmony</strong>
            </div>
          </div>

          <button class="nav-toggle" id="navToggle" type="button" aria-controls="primaryNav" aria-expanded="false">
            â˜° MenÃ¼
          </button>
        </div>

        <nav class="primary-nav" id="primaryNav">
          <div class="nav-chip">
            {% if current_user.is_authenticated %}
            <a href="{{ url_for('dashboard.dashboard_home') }}" class="nav-link {% if endpoint == 'dashboard.dashboard_home' or endpoint.startswith('dashboard.operator_') %}is-active{% endif %}">
              Web operator Paneli
            </a>
            <a href="{{ url_for('dashboard.sefer_history') }}" class="nav-link {% if endpoint == 'dashboard.sefer_history' %}is-active{% endif %}">
              Sevkiyat GeÃ§miÅŸi
            </a>

            {% if role_name == 'operator' %}
            <a href="{{ url_for('dashboard.manual_collection') }}" class="nav-link {% if endpoint == 'dashboard.manual_collection' %}is-active{% endif %}">
              Manuel Toplama
            </a>
            {% endif %}

            {% if role_name == 'admin' %}
            <a href="{{ url_for('dashboard.manage_queue') }}" class="nav-link {% if endpoint == 'dashboard.manage_queue' %}is-active{% endif %}">
              SÄ±ra YÃ¶netimi
            </a>
            <a href="{{ url_for('dashboard.manage_groups_view') }}" class="nav-link {% if endpoint == 'dashboard.manage_groups_view' %}is-active{% endif %}">
              Grup YÃ¶netimi
            </a>
            <a href="{{ url_for('dashboard.admin_users') }}" class="nav-link {% if endpoint == 'dashboard.admin_users' %}is-active{% endif %}">
              KullanÄ±cÄ± & Barkod
            </a>
            <a href="{{ url_for('dashboard.admin_logs') }}" class="nav-link {% if endpoint == 'dashboard.admin_logs' %}is-active{% endif %}">
              Sistem LoglarÄ±
            </a>
            <a href="{{ url_for('dashboard.settings_home') }}" class="nav-link {% if endpoint == 'dashboard.settings_home' %}is-active{% endif %}">
              Kontrol Merkezi
            </a>
            {% endif %}
            {% else %}
            <p class="nav-empty">Panele eriÅŸmek iÃ§in giriÅŸ yapÄ±n.</p>
            {% endif %}
          </div>

          <div class="nav-actions">
            {% if current_user.is_authenticated %}
            <div class="session-pill">
              <span class="status-dot online"></span>
              {{ display_name }}
            </div>
            <a href="{{ url_for('auth.change_password') }}" class="chip-link">Åžifre</a>
            <a href="{{ url_for('auth.logout') }}" class="chip-link danger">Ã‡Ä±kÄ±ÅŸ</a>
            {% else %}
            <a href="{{ url_for('auth.login') }}" class="chip-link primary">GiriÅŸ Yap</a>
            {% endif %}
          </div>
        </nav>
      </header>
      {% endif %}

      <main class="{{ 'auth-main' if is_auth_page else 'page-content' }}">
        <div class="{{ 'auth-viewport' if is_auth_page else 'content-viewport' }}">
          {% if not is_auth_page %}
          <div class="page-meta">
            <p class="page-eyebrow">Harmony Control Tower</p>
            <h1>{{ title or "HarmonyEcoSystem" }}</h1>
          </div>
          {% endif %}
          {% block content %}{% endblock %}
        </div>
      </main>

      {% if not is_auth_page %}
      <footer class="site-footer">
        <div class="footer-inner">
          <span>Harmony By Magna</span>
          <span class="no-copyright" aria-hidden="true">ðŸ„¯</span>
        </div>
      </footer>
      {% endif %}
    </div>

    <!-- Socket.IO Client Library -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js" crossorigin="anonymous"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
  </body>
</html>
